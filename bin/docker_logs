#!/usr/bin/env python

import os
import sys

loc = os.path.dirname(__file__).split(os.path.sep)
sys.path.insert(0, os.path.sep.join(loc[:-1]))

from util import connect

log_path = '/tmp/docker_logs'

def editor():
	if os.getenv('EDITOR'):
		editor = os.getenv('EDITOR')
	else:
		if True in ['sublime' in os.listdir(n) for n in os.getenv('PATH').split(':')]:
			editor = 'sublime'
		else:
			print '--[ sublime not found in $PATH, please set $EDITOR to the location of your editor of choice'
	return editor

try:
	os.makedirs(log_path)
except OSError as e:
	print '--[ Log path exists, overwriting logs with new ones'

c = connect.Connect(host='',keyfile='')
containers = [ n.split()[-1] for n in c.talk('docker ps')][1:]
for container in containers:
	print '--[ Retreiving log for: %s' % container
	with open(os.path.join(log_path,'%s.log'%container),'w') as data:
		for line in c.talk('docker logs %s'%container):
			data.write(line)

os.system('%s %s'%(editor(),log_path))
